<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="board">
	
	<resultMap type="commentDTO" id="commentDTOmap">
		<result column="cno" property="no"/>
		<result column="board_no" property="board_no"/>
		<result column="ccomment" property="comment"/>
		<result column="cdate" property="cdate"/>
		<result column="clike" property="clike"/>
		<result column="mid" property="mid"/>
		<result column="mname" property="mname"/>
		<result column="cip" property="cip"/>
	</resultMap>
  
	<select id ="boardList" resultType="boardDTO">
  		SELECT board_no, board_title, board_write, board_date, board_count, comment 
  		FROM boardview 
  		LIMIT 0, 10
  	</select>
  	
  	<select id="detail" resultType="boardDTO" parameterType="Integer">
  		SELECT b.board_no, b.board_title, b.board_content, m.mid AS board_write, b.board_date, b.board_ip, b.board_del, 
  		(SELECT COUNT(*) FROM comment c WHERE c.board_no=b.board_no) AS comment  
  		FROM board b join member m ON b.mno=m.mno
  		WHERE board_no=#{no} AND board_del='1'
  	</select>
  	
  	<insert id="write" parameterType="writeDTO">
  		INSERT INTO board (board_title, board_content, mno)
  		VALUES (#{title}, #{content}, (SELECT mno FROM member WHERE mid=#{mid}))
  		<selectKey resultType="Int" keyProperty="board_no" order="AFTER">
  			SELECT LAST_INSERT_ID()
  		</selectKey>
  	</insert>
  	
  	<insert id="commentWrite" parameterType="commentDTO">
  		INSERT INTO comment (board_no, mno, ccomment) 
  		VALUES (#{no}, (SELECT mno FROM member WHERE mid=#{mid}), #{comment}) 
  	</insert>
  	
  	<select id="commentsList" parameterType="Integer" resultMap="commentDTOmap">
  		SELECT cno, ccomment, cdate, clike, mid, mname, cip
  		FROM commentview
  		WHERE board_no=#{no}
  	</select>
  </mapper>